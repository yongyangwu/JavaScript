<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
        }

        html,
        body {
            height: 100%;

        }

        .mynetwork {
            height: 100%;
            /* border: 1px solid lightgray; */
        }
    </style>
    <title>Document</title>
</head>

<body>
    <button onclick="save()">保存</button>
    <button onclick="get()">获取</button>
    <button onclick="clear()">清除</button>
    <div id="mynetwork" class="mynetwork"></div>
    <!-- <div id="mynetwork2" class="mynetwork"></div> -->

    <script type="text/javascript">
        // create an array with nodes
        if (localStorage.getItem('arrPosition')) {
     
            var nodesData = JSON.parse(localStorage.getItem('arrPosition'));
        } else {
            alert(2)
            var nodesData = [
                { id: 4, label: 'Node 1', brokenImage: 'circle.png', image: 'circle.png', shape: 'image' },
                { id: 5, label: 'Node 2', brokenImage: 'circle.png', image: 'circle.png', shape: 'image' },
                { id: 5, label: 'Node 2', brokenImage: 'circle.png', image: 'circle.png', shape: 'image' },
                { id: 5, label: 'Node 2', brokenImage: 'circle.png', image: 'circle.png', shape: 'image' },
                { id: 6, label: 'Node 3', brokenImage: 'circle.png', image: 'circle.png', shape: 'image' },
                { id: 7, label: 'Node 4', brokenImage: 'circle.png', image: 'circle.png', shape: 'image' },
                { id: 8, label: 'Node 5', brokenImage: 'circle.png', image: 'circle.png', shape: 'image' }
            ];
        }
        var nodes = new vis.DataSet(nodesData);
        // create an array with edges
        var edges = new vis.DataSet([
            { from: 4, to: 5 },
            { from: 4, to: 6 },
            { from: 4, to: 7 },
            { from: 4, to: 8 }
        ]);
        // create a network
        var container = document.getElementById('mynetwork');
        // provide the data in the vis format
        var data = {
            nodes: nodes,
            edges: edges
        };
        var options = {
            manipulation:{
                enabled:true
            },
            // interaction: {
            //     dragView: true,
            //     dragNodes: true

            // },
            // // manipulation: {
            // //     enabled: true

            // // },
            // nodes: {
            //     color: {
            //         border: '#2B7CE9',
            //         background: '#97C2FC',
            //         highlight: {
            //             border: '#2B7CE9',
            //             background: '#D2E5FF'
            //         },
            //         hover: {
            //             border: '#2B7CE9',
            //             background: '#D2E5FF'
            //         }
            //     },
            //     borderWidth: 3,
            // }
        };
        // initialize your network!
        var network = new vis.Network(container, data, options);
        function save() {
            var arrPosition = network.getPositions();
            console.log('arrPosition', arrPosition)
            Object.keys(arrPosition).forEach(function (key, index) {
                nodesData[index].x = arrPosition[key].x
                nodesData[index].y = arrPosition[key].y
            });
            // for (var i = 0; i < arrPosition.length; i++) {
            //     nodesData[i].x = arrPosition[i].x
            //     nodesData[i].y = arrPosition[i].y
            // }
            localStorage.setItem('arrPosition', JSON.stringify(nodesData))
        }
        function get() {
            console.log('network.getScale()',network.getScale())
            console.log(network.getViewPosition())
            console.log(network.getPositions())
            console.log(network.DOMtoCanvas())

        }

        network.on('dragEnd', function (item) {
            console.log('拖动end')
            console.log(network.getViewPosition())
            console.log(network.getPositions())
        })


        // console.log(JSON.parse(localStorage.getItem('arrPosition')))

        function clear() {
            localStorage.removeItem('arrPosition')

        }

    </script>

</body>

</html>